<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link href="/styles/jsoneditor.min.css" rel="stylesheet" type="text/css">
        <link href="/styles/custom.css" rel="stylesheet" type="text/css">
    <script src="/js/jsoneditor.min.js"></script>
        <script
          src="https://code.jquery.com/jquery-3.4.1.min.js"
          integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
          crossorigin="anonymous">
      </script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="js/wizard.js"></script>
        <script>

	</script>
    </head>
    <body>
        <div class="container">
            <header class="blog-header py-3">
                <div class="row justify-content-center">
                    <div class="col offset-md-4">
                        <a href="https://fastspring.com" target="_blank" style="color: transparent;">
                            <img src="images/fastspring-logo.png" alt="homepage" class="fs-logo">
                        </a>
                    </div>
                </div>
            </header>
            <div class="row">
                <div class="col-6">
                    <div id='raw-code'>
                        <div class="row">
                            <div id="jsoneditor" class="col-12" style="height: 400px"></div>
                            </div>
                        <button type="button" class="btn btn-primary" onclick="encryptPayload()">
                            Encrypt Payload
                        </button>
                    </div>
                    <br/>
                    <div class="card card-body" style="background-color: #8080800d;">
                        <pre>
                            <code id="encrypted-code">
                           </code>
                           </pre>
                       </div>
                       <button type="button" class="btn btn-primary" onclick="secureCall()">
                            Execute
                        </button>
                </div>
                <div class="col-6">
                    <div id='wizard-checklist-container'>
                        <div class="card">
                            <div class="card-header" id="headingOne" style="display:flex; justify-content: space-between;">
                                <b> Encryption Wizard - checklist </b>
                                
                                    <a href="/wizard.html" style="color:#007bff">
                                        Reset 
                                    </a>
                                
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <input disabled id="storefront-checked" type="checkbox">
                                            </input>
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" value="Choose custom storefront" onclick="openStorefrontModal()">
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <input disabled id="keys-checked" type="checkbox" >
                                            </input>
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" value="Create keys" onclick="openKeysModal()">
                                </div>
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <input disabled id="payload-checked" type="checkbox">
                                            </input>
                                        </div>
                                    </div>
                                    <input type="text" class="form-control" value="Create and execute a valid encrypted payload">
                                </div>
                                    <p>
                                        As a last step.. [talk about payload validity and which attributes can be added)
                                        This tool does the encryption using the keys previously generated. If
                                    </p>

                                <button type="button" class="btn btn-success">
                                    
                                    <a href="/index.html" style="color:white">
                                        Close wizard 
                                    </a>
                                </button>
                            </div>
                        </div>
                    </div>  
                </div>
            </div>
        </div>

        
<!-- Update Storefront Modal -->
    <div class="modal fade" id="updateStorefrontModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
         <div class="modal-dialog" role="document">
            <div class="modal-content">
               <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Change storefront</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
               </div>
               <div class="modal-body">
                   <div class="accordion" id="store-accordion">
                       <div class="card">
                           <div class="card-header" id="headingTwo">
                               <h2 class="mb-0">
                                   <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                       Add custom storefront
                                   </button>
                               </h2>
                           </div>
                           <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#store-accordion">
                               <div class="card-body">
                                   <form id="popupFormStorefront" name="popupFormStorefront" onsubmit="setCustomStorefront(); return false;" class="needs-validation" novalidate>
                                       <div class="form-group">
                                           <label for="storefrontId" class="col-form-label">Storefront Id:</label>
                                           <input type="text" class="form-control" id="storefrontId" name="storefrontId" required="required"
                                                                                                                         pattern="^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(\/[a-z0-9-]*)?$"
                                                                                                                         title="....test.onfastspring.com...">
                                           <div class="invalid-feedback"> Please insert a valid storefrontId</div>
                                       </div>
                                       <div class="form-group">
                                           <label for="accessKey" class="col-form-label"> Access Key:</label>
                                           <input class="form-control" type="text" id="accessKey" name="accessKey" pattern=".{22,}" required="required">
                                           <div class="invalid-feedback"> Please insert a valid 22 characters access key</div>
                                       </div>
                                       <button type="submit" class="btn btn-primary" id="addStorefrontBtn"> Add </button>
                                   </form>
                               </div>
                           </div>
                       </div>
                   </div>
                </div>
                <div class="modal-footer">
                    <button disabled type="button" class="btn btn-primary" data-step="initial" id="goToKeysForm"> Next </button>
                </div>
            </div>
         </div>
   </div>


        <div class="modal fade bd-example-modal-lg" id="createKeysModal" tabindex="-1" role="dialog" aria-labelledby="createKeysModal" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="keys-modal-title"> Keys </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div id="charge-form-wrapper">
                        <div class="modal-body" >
                            <div id="initial-container">
                                <p> Thanks for selecting your storefront.</p>
                                <p>
                                The process of passing data securely through SBL requires a pair of private and public keys which will be used to encrypt the payload containing
                                the custom buyer's shopping cart. FastSpring instantly decrypts this payload upon receipt and applies the decrypted data to the current session.
                                This is why, as a first step, you need to define this keys pair. Please select one of the below option:
                                </p>

                                <form name="keys-form" id="keys-form">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="radio-keys" value="new-keys-result">
                                        <label class="form-check-label" for="exampleRadios1">
                                            I need to create new keys
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="radio-keys" value="existing-keys">
                                        <label class="form-check-label" for="exampleRadios1">
                                            I already have a private key and a public cert uploaded in my dashboard
                                        </label>
                                    </div>
                                </form>
                            </div>
                            <div id="existing-keys-container" style="display:none">
                                Please paste your key here:
                                <form name="custom-key-form" id="keys-form">
                                    <textarea class="form-control" name="custom-privateKey" rows="13">
                                    </textarea>
                                </form>
                            </div>
                            <div id="new-keys-result-container" style="display:none">
                                <p> Please now proceed to securely store the private key in your system and upload the public certificate to your dashboard. </p>
                                
                                <p> Once you have done, the next step is to create the payload representing the custom buyer's session. Click on the "Next" button when ready.</p>
                            
                                <div id="accordion">
                                    <div class="card">
                                        <div class="card-header" id="headingOne">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOneNew" aria-expanded="true" aria-controls="collapseOneNew">
                                                    Private Key
                                                </button>
                                            </h5>
                                        </div>

                                        <div id="collapseOneNew" class="collapse" aria-labelledby="headingOneNew" data-parent="#accordion">
                                            <div class="card-body privateKey">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-header" id="headingTwo">
                                            <h5 class="mb-0">
                                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwoNew" aria-expanded="false" aria-controls="collapseTwoNew">
                                                    Public Certificate
                                                </button>
                                            </h5>
                                        </div>
                                        <div id="collapseTwoNew" class="collapse" aria-labelledby="headingTwoNew" data-parent="#accordion">
                                            <div class="card-body publicKey">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button disabled type="button" class="btn btn-primary" data-step="initial" id="createKeysBtn"> Next </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script>

        
        // create the editor
        
        let FSGlobal = {};
        let JsonEditor = {};

        function openKeysModal() {
            $("#createKeysModal").modal("show");
        }

        function openStorefrontModal() {
            $("#updateStorefrontModal").modal("show");
        }
        
    </script>
    </body>
</html>
